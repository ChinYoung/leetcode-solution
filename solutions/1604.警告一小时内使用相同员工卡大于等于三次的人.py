#
# @lc app=leetcode.cn id=1604 lang=python3
#
# [1604] 警告一小时内使用相同员工卡大于等于三次的人
#

# @lc code=start
from typing import List, Dict


class Solution:
    def alertNames(self, keyName: List[str], keyTime: List[str]) -> List[str]:
        res = []
        res_log = {}
        log_map: Dict[List] = {}
        for i in range(len(keyName)):
            k, t = keyName[i], keyTime[i]
            m = self.toMinute(t)
            k_log = log_map.setdefault(k, [0] * 60 * 24)
            k_log[m] = 1
            if res_log.setdefault(k, False):
                continue
            if self.search_in_hour(m, k_log, k):
                res_log[k] = True
                res.append(k)
        return sorted(res)

    def search_in_hour(self, m: int, log: List[int], k):
        local_log = []
        max_index = 60 * 24 - 1
        min_index = 0
        low_end = m
        high_start = m
        for i in range(1, 61):
            low_next = m - i
            high_next = m + i
            if low_next >= min_index and log[low_next] == 1:
                local_log.insert(0, low_end - low_next)
                low_end = low_next
            if high_next <= max_index and log[high_next] == 1:
                local_log.append(high_next - high_start)
                high_start = high_next
        for i in range(len(local_log) - 1):
            if local_log[i] + local_log[i+1] <= 60:
                return True
        return False

    def toMinute(self, t: str):
        [h, m] = t.split(':')
        return 60 * int(h) + int(m)
# @lc code=end

if __name__ == "__main__":
    s = Solution()
    keyName = ["daniel","daniel","daniel","luis","luis","luis","luis"]
    keyTime = ["10:00","10:40","11:00","09:00","11:00","13:00","15:00"]
    print(s.alertNames(keyName, keyTime))
    keyName = ["alice","alice","alice","bob","bob","bob","bob"]
    keyTime = ["12:01","12:00","18:00","21:00","21:20","21:30","23:00"]
    print(s.alertNames(keyName, keyTime))
    keyName = ["john","john","john"]
    keyTime = ["23:58","23:59","00:01"]
    print(s.alertNames(keyName, keyTime))
    keyName = ["aa","aa","aa","aa","aa","aa","aa","aa","aa","aa","ba","ba","ba","ba","ba","ba","ba","ba","ba","ba","ca","ca","ca","ca","ca","ca","ca","ca","ca","ca","da","da","da","da","da","da","da","da","da","da","ea","ea","ea","ea","ea","ea","ea","ea","ea","ea","fa","fa","fa","fa","fa","fa","fa","fa","fa","fa","ga","ga","ga","ga","ga","ga","ga","ga","ga","ga","ha","ha","ha","ha","ha","ha","ha","ha","ha","ha","ia","ia","ia","ia","ia","ia","ia","ia","ia","ia","ja","ja","ja","ja","ja","ja","ja","ja","ja","ja","ka","ka","ka","ka","ka","ka","ka","ka","ka","ka","la","la","la","la","la","la","la","la","la","la","ma","ma","ma","ma","ma","ma","ma","ma","ma","ma","na","na","na","na","na","na","na","na","na","na","oa","oa","oa","oa","oa","oa","oa","oa","oa","oa","pa","pa","pa","pa","pa","pa","pa","pa","pa","pa","qa","qa","qa","qa","qa","qa","qa","qa","qa","qa","ra","ra","ra","ra","ra","ra","ra","ra","ra","ra","sa","sa","sa","sa","sa","sa","sa","sa","sa","sa","ta","ta","ta","ta","ta","ta","ta","ta","ta","ta","ua","ua","ua","ua","ua","ua","ua","ua","ua","ua","va","va","va","va","va","va","va","va","va","va","wa","wa","wa","wa","wa","wa","wa","wa","wa","wa","xa","xa","xa","xa","xa","xa","xa","xa","xa","xa","ya","ya","ya","ya","ya","ya","ya","ya","ya","ya","za","za","za","za","za","za","za","za","za","za","ab","ab","ab","ab","ab","ab","ab","ab","ab","ab","bb","bb","bb","bb","bb","bb","bb","bb","bb","bb","cb","cb","cb","cb","cb","cb","cb","cb","cb","cb","db","db","db","db","db","db","db","db","db","db","eb","eb","eb","eb","eb","eb","eb","eb","eb","eb","fb","fb","fb","fb","fb","fb","fb","fb","fb","fb","gb","gb","gb","gb","gb","gb","gb","gb","gb","gb","hb","hb","hb","hb","hb","hb","hb","hb","hb","hb","ib","ib","ib","ib","ib","ib","ib","ib","ib","ib","jb","jb","jb","jb","jb","jb","jb","jb","jb","jb","kb","kb","kb","kb","kb","kb","kb","kb","kb","kb","lb","lb","lb","lb","lb","lb","lb","lb","lb","lb","mb","mb","mb","mb","mb","mb","mb","mb","mb","mb","nb","nb","nb","nb","nb","nb","nb","nb","nb","nb","ob","ob","ob","ob","ob","ob","ob","ob","ob","ob","pb","pb","pb","pb","pb","pb","pb","pb","pb","pb","qb","qb","qb","qb","qb","qb","qb","qb","qb","qb","rb","rb","rb","rb","rb","rb","rb","rb","rb","rb","sb","sb","sb","sb","sb","sb","sb","sb","sb","sb","tb","tb","tb","tb","tb","tb","tb","tb","tb","tb","ub","ub","ub","ub","ub","ub","ub","ub","ub","ub","vb","vb","vb","vb","vb","vb","vb","vb","vb","vb","wb","wb","wb","wb","wb","wb","wb","wb","wb","wb","xb","xb","xb","xb","xb","xb","xb","xb","xb","xb"]
    keyTime = ["06:38","22:44","01:48","16:50","07:03","21:07","16:32","02:45","13:58","08:26","12:26","11:17","08:20","08:32","19:21","18:24","00:46","05:47","06:54","23:50","04:09","02:00","05:28","22:38","13:19","19:44","09:17","06:19","15:38","05:08","03:03","14:49","19:34","01:37","15:52","18:51","10:46","03:51","17:51","21:19","10:45","03:41","03:22","02:45","19:36","13:07","12:10","13:42","12:40","02:40","18:38","19:06","08:55","01:19","14:14","16:29","10:08","10:15","15:51","08:09","16:13","06:50","22:43","17:24","18:26","23:36","20:54","17:14","13:15","05:24","22:51","06:07","21:27","21:03","03:45","05:03","07:45","05:46","23:51","21:58","07:58","07:10","10:58","14:45","04:14","16:22","16:53","02:20","05:24","00:04","19:02","22:42","16:27","12:52","16:02","01:45","02:04","09:18","07:50","06:31","11:39","21:06","17:32","08:49","18:37","09:32","13:37","07:10","22:07","18:16","04:20","21:13","03:27","00:30","21:41","03:09","02:41","12:24","22:14","10:06","02:13","08:31","19:41","12:56","03:52","21:16","02:05","22:28","01:17","22:26","20:27","18:35","03:04","19:36","09:47","01:19","06:52","15:27","18:05","17:54","05:29","10:26","15:40","18:02","03:58","10:59","22:33","10:38","07:00","08:29","01:33","07:29","20:51","00:40","15:04","08:03","11:09","03:28","05:19","14:27","11:57","21:44","05:35","08:44","04:26","05:49","02:53","11:11","15:49","11:58","05:37","15:34","01:04","02:08","01:57","19:50","20:26","05:31","05:41","01:15","08:52","03:37","11:59","20:37","12:27","03:38","00:11","22:26","22:31","23:50","13:54","11:49","17:39","16:53","00:13","20:18","17:04","05:33","02:43","00:31","20:17","15:28","18:55","10:35","22:06","05:11","15:32","04:05","20:47","05:17","17:45","20:48","21:06","14:09","21:58","09:25","04:42","08:01","02:16","08:36","00:23","03:28","18:17","14:08","01:12","02:16","14:22","13:13","09:30","21:24","09:29","09:49","22:14","21:46","01:00","23:13","17:29","13:54","00:28","23:01","13:33","15:58","02:56","07:57","01:14","15:18","07:16","22:20","18:28","01:06","17:53","01:28","23:43","04:42","19:46","01:12","05:29","19:41","16:48","23:44","06:33","12:01","12:37","01:15","18:48","19:11","07:53","06:55","20:06","10:35","12:07","13:19","03:16","09:28","20:44","08:51","04:04","20:36","18:37","23:09","01:19","05:30","12:45","01:09","17:04","07:22","20:08","12:52","18:40","04:13","01:56","05:55","21:16","14:22","12:13","21:44","19:01","12:59","02:43","12:46","13:42","14:32","06:53","13:05","07:49","16:12","20:02","11:45","20:37","15:54","01:15","04:02","22:04","06:41","08:38","08:30","14:46","06:16","01:17","14:18","03:10","14:05","20:29","10:49","05:59","20:51","06:51","11:23","12:02","10:00","18:06","11:38","12:12","01:42","17:08","20:11","21:04","12:10","21:36","05:08","03:40","17:02","10:09","04:46","03:16","02:41","11:54","10:40","09:36","00:33","06:16","19:56","11:06","00:46","10:28","04:31","08:33","16:07","13:35","00:28","07:00","09:48","14:15","18:06","17:01","09:51","13:24","21:21","01:01","03:20","14:29","03:12","00:35","07:34","18:27","00:47","00:24","02:31","13:18","23:04","04:35","20:14","03:47","23:52","02:44","09:23","19:11","14:23","01:24","13:36","10:55","06:39","16:00","01:50","07:14","01:32","05:57","19:53","09:20","10:53","13:13","21:29","17:40","21:13","05:20","14:41","16:04","16:40","22:41","05:41","21:09","19:20","21:08","08:17","16:47","12:27","01:16","23:22","23:12","12:46","10:11","02:22","21:12","23:52","21:38","04:30","05:10","19:10","12:08","05:45","00:12","13:12","10:20","08:34","21:58","07:53","22:29","05:01","08:21","04:38","17:07","07:06","09:25","05:02","15:45","08:27","11:05","08:24","14:22","01:04","09:58","13:38","01:56","23:44","08:21","11:09","14:10","14:54","15:32","02:05","05:09","12:25","13:53","09:17","20:39","04:27","06:51","22:39","16:44","16:09","17:36","21:33","22:49","08:43","11:48","05:14","14:25","14:40","17:05","13:42","13:18","03:58","11:46","04:32","08:49","09:43","04:37","10:53","06:57","22:21","21:09","07:01","20:25","16:39","15:01","00:36","05:15","20:36","04:34","01:21"]
    print(s.alertNames(keyName, keyTime))

